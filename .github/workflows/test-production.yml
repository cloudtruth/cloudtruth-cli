# This runs a small set of basic tests against the production deployment, using the latest released
# CLI image.
---
name: Production
on:
  workflow_dispatch:

jobs:
  test:
    name: Basic Integration Test (Production)
    runs-on: macos-latest

    env:
      CLOUDTRUTH_API_KEY: ${{ secrets.CI_ACCT_READWRITE_CT_API_KEY }}
      RUST_BACKTRACE: 1
      JOB_ID: ${{github.repository}}-${{github.run_id}}-${{github.run_attempt}}-cli-prod

    steps:
      - uses: actions/checkout@v3

      - name: CLI installation
        run: |
          sudo ./install.sh
          cloudtruth --version

      - name: Prerequisites
        run: make test_prerequisites

      - name: Integration Test
        shell: bash
        working-directory: integration-tests
        run: python3 live_test.py --job-id "$JOB_ID" --filter basic --exclude backup
